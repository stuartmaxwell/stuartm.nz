{% extends "base.html" %}

{% block title %}Markdown Editor{% endblock %}

{% block head %}
  <script type="module" src="https://pyscript.net/releases/2024.6.1/core.js"></script>
{% endblock head %}

{% block content %}

  <h1>Markdown Editor</h1>
  <div id="markdown-editor">
    <div><button id="copymarkdown">Copy Text</button> <span id="loading" aria-busy="true">Loading...</span></div>
    <div><button id="copyhtml">Copy HTML</button></div>
    <div id="editor" py-keyup="preview"></div>
    <div id="preview"></div>
  </div>

  <script type="py" config='{"packages":["markdown", "pygments", "pymdown-extensions"]}'>
    import markdown
    import pymdownx.emoji
    from pyscript import document
    extension_configs = {
      "pymdownx.emoji": {"emoji_generator": pymdownx.emoji.to_alt},
      }
    md = markdown.Markdown(extensions=["pymdownx.superfences", "pymdownx.highlight", "pymdownx.emoji", "tables", "toc"], output_format="html", extension_configs=extension_configs)
    def preview(event):
      input = document.querySelector("#editor").innerText
      output = document.querySelector("#preview")
      output.innerHTML = md.convert(input)
      md.reset()
  </script>

  <script>
    window.addEventListener('py:ready', function() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('editor').setAttribute('contenteditable', 'true');
      document.getElementById('editor').focus();

    });

    document.getElementById('copyhtml').addEventListener('click', function() {
      const editorContent = document.getElementById('preview').innerHTML;

      navigator.clipboard.writeText(editorContent).then(function() {
        console.log('Content copied to clipboard');
        // Optionally, provide user feedback here
        document.getElementById('copyhtml').innerText = 'Copied! ðŸ‘';
        setTimeout(() => {
          document.getElementById('copyhtml').innerText = 'Copy HTML';
        }, 3000);
      }).catch(function(err) {
        console.error('Failed to copy: ', err);
      });
    });

    document.getElementById('copymarkdown').addEventListener('click', function() {
      const editorContent = document.getElementById('editor').innerText;

      navigator.clipboard.writeText(editorContent).then(function() {
        console.log('Content copied to clipboard');
        // Optionally, provide user feedback here
        document.getElementById('copymarkdown').innerText = 'Copied! ðŸ‘';
        setTimeout(() => {
          document.getElementById('copymarkdown').innerText = 'Copy Markdown';
        }, 3000);
      }).catch(function(err) {
        console.error('Failed to copy: ', err);
      });
    });
  </script>

{% endblock content %}
